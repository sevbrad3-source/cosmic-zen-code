import { Shield, AlertTriangle, FolderOpen, FileText, Database, Search, Terminal } from "lucide-react";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { useState } from "react";
import { toast } from "sonner";

interface FileItem {
  name: string;
  type: "file" | "directory";
  size?: string;
  modified?: string;
}

interface RegistryKey {
  path: string;
  value: string;
  type: string;
}

const PostExploitationPanel = () => {
  const [currentPath, setCurrentPath] = useState("C:\\Users\\demo_user");
  const [searchQuery, setSearchQuery] = useState("");
  
  const [mockFiles] = useState<FileItem[]>([
    { name: "Documents", type: "directory", modified: "2024-01-15" },
    { name: "Downloads", type: "directory", modified: "2024-01-20" },
    { name: "important_data.xlsx", type: "file", size: "2.3 MB", modified: "2024-01-18" },
    { name: "passwords.txt", type: "file", size: "512 KB", modified: "2024-01-10" },
    { name: "config.json", type: "file", size: "4 KB", modified: "2024-01-22" },
  ]);

  const [mockRegistry] = useState<RegistryKey[]>([
    { path: "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion", value: "ProgramFilesDir", type: "REG_SZ" },
    { path: "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run", value: "StartupApp", type: "REG_SZ" },
    { path: "HKLM\\SYSTEM\\CurrentControlSet\\Services", value: "ServiceName", type: "REG_MULTI_SZ" },
  ]);

  const handleFileAction = (action: string, item: FileItem) => {
    toast.info("üéÆ SIMULATION MODE", {
      description: `Mock ${action} on "${item.name}". No actual file operations occur. Training only.`,
      duration: 4000
    });
  };

  const handleRegistryAction = (action: string) => {
    toast.info("üéÆ SIMULATION MODE", {
      description: `Mock registry ${action}. No actual registry changes occur. Training only.`,
      duration: 4000
    });
  };

  const handleSystemCommand = (command: string) => {
    toast.info("üéÆ SIMULATION MODE", {
      description: `Mock system command: "${command}". No actual system reconnaissance occurs. Educational visualization only.`,
      duration: 4000
    });
  };

  return (
    <div className="p-3 space-y-3">
      {/* Critical Safety Banner */}
      <div className="bg-status-error/10 border border-status-error/30 rounded p-2 flex items-start gap-2">
        <Shield className="w-4 h-4 text-status-error flex-shrink-0 mt-0.5" />
        <div className="text-xs">
          <div className="font-semibold text-status-error mb-1">CRITICAL: SIMULATION ONLY</div>
          <div className="text-text-secondary">All post-exploitation activities are simulated. No actual file access, registry manipulation, or system commands occur. Training purposes exclusively.</div>
        </div>
      </div>

      <Tabs defaultValue="files" className="w-full">
        <TabsList className="grid w-full grid-cols-3 h-8">
          <TabsTrigger value="files" className="text-xs">Files</TabsTrigger>
          <TabsTrigger value="registry" className="text-xs">Registry</TabsTrigger>
          <TabsTrigger value="recon" className="text-xs">Recon</TabsTrigger>
        </TabsList>

        {/* File System Browser */}
        <TabsContent value="files" className="space-y-3 mt-3">
          <div className="space-y-2">
            <div className="flex items-center gap-2">
              <Input
                value={currentPath}
                onChange={(e) => setCurrentPath(e.target.value)}
                className="h-8 text-xs font-mono"
                placeholder="File path..."
              />
              <Button size="sm" className="h-8 px-2">
                <FolderOpen className="w-3 h-3" />
              </Button>
            </div>

            <Input
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              placeholder="Search files..."
              className="h-8 text-xs"
            />
          </div>

          <ScrollArea className="h-64 border border-border rounded-lg bg-surface-elevated">
            <div className="p-2 space-y-1">
              {mockFiles.map((item, idx) => (
                <div
                  key={idx}
                  className="flex items-center justify-between p-2 hover:bg-surface-hover rounded border border-transparent hover:border-border transition-colors group"
                >
                  <div className="flex items-center gap-2 flex-1 min-w-0">
                    {item.type === "directory" ? (
                      <FolderOpen className="w-3 h-3 text-accent flex-shrink-0" />
                    ) : (
                      <FileText className="w-3 h-3 text-text-muted flex-shrink-0" />
                    )}
                    <div className="flex-1 min-w-0">
                      <div className="text-xs font-medium text-text-primary truncate">{item.name}</div>
                      <div className="text-[10px] text-text-muted">
                        {item.size && `${item.size} ‚Ä¢ `}
                        {item.modified}
                      </div>
                    </div>
                  </div>
                  <div className="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                    <Button
                      size="sm"
                      variant="outline"
                      className="h-6 px-2 text-[10px]"
                      onClick={() => handleFileAction("download", item)}
                    >
                      Download
                    </Button>
                    <Button
                      size="sm"
                      variant="outline"
                      className="h-6 px-2 text-[10px]"
                      onClick={() => handleFileAction("delete", item)}
                    >
                      Delete
                    </Button>
                  </div>
                </div>
              ))}
            </div>
          </ScrollArea>

          <div className="flex items-center gap-1.5 text-[10px] text-status-info">
            <AlertTriangle className="w-3 h-3" />
            <span>All files are simulated mock data</span>
          </div>
        </TabsContent>

        {/* Registry Editor */}
        <TabsContent value="registry" className="space-y-3 mt-3">
          <Input
            placeholder="Registry path..."
            className="h-8 text-xs font-mono"
            defaultValue="HKEY_LOCAL_MACHINE\\"
          />

          <ScrollArea className="h-64 border border-border rounded-lg bg-surface-elevated">
            <div className="p-2 space-y-1">
              {mockRegistry.map((key, idx) => (
                <div
                  key={idx}
                  className="p-2 hover:bg-surface-hover rounded border border-transparent hover:border-border transition-colors group"
                >
                  <div className="flex items-start gap-2">
                    <Database className="w-3 h-3 text-accent mt-0.5 flex-shrink-0" />
                    <div className="flex-1 min-w-0">
                      <div className="text-xs font-mono text-text-primary break-all">{key.path}</div>
                      <div className="text-[10px] text-text-muted mt-1">
                        <span className="text-text-secondary">Value:</span> {key.value}
                      </div>
                      <Badge variant="outline" className="text-[9px] px-1 py-0 mt-1">
                        {key.type}
                      </Badge>
                    </div>
                  </div>
                  <div className="flex gap-1 mt-2 opacity-0 group-hover:opacity-100 transition-opacity">
                    <Button
                      size="sm"
                      variant="outline"
                      className="h-6 px-2 text-[10px]"
                      onClick={() => handleRegistryAction("read")}
                    >
                      Read
                    </Button>
                    <Button
                      size="sm"
                      variant="outline"
                      className="h-6 px-2 text-[10px]"
                      onClick={() => handleRegistryAction("modify")}
                    >
                      Modify
                    </Button>
                  </div>
                </div>
              ))}
            </div>
          </ScrollArea>

          <div className="flex items-center gap-1.5 text-[10px] text-status-info">
            <AlertTriangle className="w-3 h-3" />
            <span>All registry keys are simulated</span>
          </div>
        </TabsContent>

        {/* System Reconnaissance */}
        <TabsContent value="recon" className="space-y-3 mt-3">
          <div className="bg-surface-elevated border border-border rounded-lg p-3 space-y-2">
            <div className="text-xs font-semibold text-text-primary mb-2">RECONNAISSANCE COMMANDS</div>
            
            <div className="space-y-2">
              <Button
                size="sm"
                variant="outline"
                className="w-full h-8 text-xs justify-start gap-2"
                onClick={() => handleSystemCommand("systeminfo")}
              >
                <Terminal className="w-3 h-3" />
                System Information (Mock)
              </Button>

              <Button
                size="sm"
                variant="outline"
                className="w-full h-8 text-xs justify-start gap-2"
                onClick={() => handleSystemCommand("net user")}
              >
                <Terminal className="w-3 h-3" />
                Enumerate Users (Mock)
              </Button>

              <Button
                size="sm"
                variant="outline"
                className="w-full h-8 text-xs justify-start gap-2"
                onClick={() => handleSystemCommand("netstat -ano")}
              >
                <Terminal className="w-3 h-3" />
                Network Connections (Mock)
              </Button>

              <Button
                size="sm"
                variant="outline"
                className="w-full h-8 text-xs justify-start gap-2"
                onClick={() => handleSystemCommand("tasklist")}
              >
                <Terminal className="w-3 h-3" />
                Running Processes (Mock)
              </Button>

              <Button
                size="sm"
                variant="outline"
                className="w-full h-8 text-xs justify-start gap-2"
                onClick={() => handleSystemCommand("wmic qfe")}
              >
                <Terminal className="w-3 h-3" />
                Installed Patches (Mock)
              </Button>

              <Button
                size="sm"
                variant="outline"
                className="w-full h-8 text-xs justify-start gap-2"
                onClick={() => handleSystemCommand("net share")}
              >
                <Terminal className="w-3 h-3" />
                Network Shares (Mock)
              </Button>
            </div>
          </div>

          <div className="flex items-center gap-1.5 text-[10px] text-status-info">
            <AlertTriangle className="w-3 h-3" />
            <span>All commands are simulated visualizations</span>
          </div>
        </TabsContent>
      </Tabs>

      {/* Educational Notice */}
      <div className="bg-accent/5 border border-accent/20 rounded p-2.5">
        <div className="flex items-start gap-2">
          <AlertTriangle className="w-4 h-4 text-accent flex-shrink-0 mt-0.5" />
          <div className="text-[11px] text-text-secondary space-y-1">
            <div className="font-semibold text-text-primary">Post-Exploitation Training Interface</div>
            <div>This demonstrates post-exploitation techniques for defensive security education. No actual system access or data manipulation occurs.</div>
            <div className="pt-1 text-status-warning">‚ö†Ô∏è Real post-exploitation activities are illegal outside authorized penetration testing in controlled VM environments.</div>
          </div>
        </div>
      </div>

      {/* Safety Features */}
      <div className="text-xs text-text-muted space-y-2 pt-2">
        <div className="font-semibold text-text-secondary">SAFETY GUARANTEES:</div>
        <ul className="space-y-1 text-[11px] list-disc list-inside">
          <li>All file data is simulated</li>
          <li>No actual registry access</li>
          <li>No system commands executed</li>
          <li>Educational mockup interface only</li>
        </ul>
      </div>
    </div>
  );
};

export default PostExploitationPanel;
