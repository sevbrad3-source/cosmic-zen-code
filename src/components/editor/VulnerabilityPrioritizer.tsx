import { useState } from "react";
import { Card } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Progress } from "@/components/ui/progress";
import { AlertTriangle, TrendingUp, DollarSign, Zap } from "lucide-react";

interface Vulnerability {
  id: string;
  title: string;
  cvss: number;
  exploitability: number;
  businessImpact: number;
  priority: number;
  host: string;
  description: string;
  severity: "critical" | "high" | "medium" | "low";
}

const VulnerabilityPrioritizer = () => {
  const [vulnerabilities] = useState<Vulnerability[]>([
    {
      id: "1",
      title: "SQL Injection in authentication",
      cvss: 9.8,
      exploitability: 95,
      businessImpact: 100,
      priority: 98,
      host: "192.168.1.10:443",
      description: "Critical SQL injection allowing authentication bypass",
      severity: "critical"
    },
    {
      id: "2",
      title: "Remote Code Execution via deserialization",
      cvss: 9.1,
      exploitability: 85,
      businessImpact: 95,
      priority: 93,
      host: "192.168.1.25:8080",
      description: "RCE vulnerability in Java deserialization endpoint",
      severity: "critical"
    },
    {
      id: "3",
      title: "SMB signing not enforced",
      cvss: 8.1,
      exploitability: 70,
      businessImpact: 80,
      priority: 77,
      host: "192.168.1.25:445",
      description: "Missing SMB signing enables MITM attacks",
      severity: "high"
    },
    {
      id: "4",
      title: "Weak TLS cipher suites",
      cvss: 5.3,
      exploitability: 40,
      businessImpact: 60,
      priority: 48,
      host: "192.168.1.10:443",
      description: "Legacy cipher suites vulnerable to downgrade attacks",
      severity: "medium"
    },
    {
      id: "5",
      title: "Information disclosure in error messages",
      cvss: 4.3,
      exploitability: 30,
      businessImpact: 40,
      priority: 35,
      host: "192.168.1.50:80",
      description: "Detailed error messages expose system information",
      severity: "low"
    }
  ]);

  const getPriorityColor = (priority: number) => {
    if (priority >= 90) return "text-red-500";
    if (priority >= 70) return "text-orange-500";
    if (priority >= 50) return "text-yellow-500";
    return "text-blue-500";
  };

  const getPriorityBg = (priority: number) => {
    if (priority >= 90) return "bg-red-500";
    if (priority >= 70) return "bg-orange-500";
    if (priority >= 50) return "bg-yellow-500";
    return "bg-blue-500";
  };

  const getSeverityColor = (severity: string) => {
    switch (severity) {
      case "critical": return "bg-red-500/20 text-red-500";
      case "high": return "bg-orange-500/20 text-orange-500";
      case "medium": return "bg-yellow-500/20 text-yellow-500";
      case "low": return "bg-blue-500/20 text-blue-500";
      default: return "";
    }
  };

  return (
    <div className="h-full overflow-y-auto p-4 space-y-4">
      <div className="flex items-center justify-between">
        <h3 className="text-sm font-semibold text-text-primary">Vulnerability Prioritization</h3>
        <Button size="sm" className="h-7">
          Recalculate
        </Button>
      </div>

      <Card className="p-4 bg-panel-bg border-border">
        <h4 className="text-sm font-semibold text-text-primary mb-3">Prioritization Algorithm</h4>
        <div className="space-y-2 text-xs">
          <div className="flex items-center justify-between">
            <span className="text-text-secondary">CVSS Base Score</span>
            <span className="text-text-primary font-semibold">40% weight</span>
          </div>
          <div className="flex items-center justify-between">
            <span className="text-text-secondary">Exploitability</span>
            <span className="text-text-primary font-semibold">35% weight</span>
          </div>
          <div className="flex items-center justify-between">
            <span className="text-text-secondary">Business Impact</span>
            <span className="text-text-primary font-semibold">25% weight</span>
          </div>
        </div>
      </Card>

      <div className="space-y-3">
        <div className="flex items-center justify-between">
          <h4 className="text-xs font-semibold text-text-secondary">Prioritized Vulnerabilities</h4>
          <span className="text-xs text-text-muted">{vulnerabilities.length} total</span>
        </div>

        {vulnerabilities.map((vuln, index) => (
          <Card key={vuln.id} className="p-4 bg-panel-bg border-border">
            <div className="flex items-start gap-3 mb-3">
              <div className="flex-shrink-0 w-10 h-10 rounded-full bg-activitybar-active/10 flex items-center justify-center">
                <span className={`text-lg font-bold ${getPriorityColor(vuln.priority)}`}>
                  #{index + 1}
                </span>
              </div>
              <div className="flex-1">
                <div className="flex items-start justify-between mb-1">
                  <h5 className="text-sm font-semibold text-text-primary">{vuln.title}</h5>
                  <Badge className={getSeverityColor(vuln.severity)}>
                    {vuln.severity.toUpperCase()}
                  </Badge>
                </div>
                <p className="text-xs text-text-secondary mb-2">{vuln.description}</p>
                <div className="text-xs text-text-muted">{vuln.host}</div>
              </div>
            </div>

            <div className="space-y-3">
              <div>
                <div className="flex items-center justify-between text-xs mb-1">
                  <span className="text-text-secondary font-medium">Priority Score</span>
                  <span className={`font-bold ${getPriorityColor(vuln.priority)}`}>
                    {vuln.priority}/100
                  </span>
                </div>
                <Progress value={vuln.priority} className={`h-2 ${getPriorityBg(vuln.priority)}`} />
              </div>

              <div className="grid grid-cols-3 gap-3">
                <div className="space-y-1">
                  <div className="flex items-center gap-1 text-xs text-text-secondary">
                    <AlertTriangle className="w-3 h-3" />
                    <span>CVSS</span>
                  </div>
                  <div className="text-sm font-bold text-text-primary">{vuln.cvss}</div>
                  <Progress value={vuln.cvss * 10} className="h-1" />
                </div>
                <div className="space-y-1">
                  <div className="flex items-center gap-1 text-xs text-text-secondary">
                    <Zap className="w-3 h-3" />
                    <span>Exploit</span>
                  </div>
                  <div className="text-sm font-bold text-text-primary">{vuln.exploitability}%</div>
                  <Progress value={vuln.exploitability} className="h-1" />
                </div>
                <div className="space-y-1">
                  <div className="flex items-center gap-1 text-xs text-text-secondary">
                    <DollarSign className="w-3 h-3" />
                    <span>Impact</span>
                  </div>
                  <div className="text-sm font-bold text-text-primary">{vuln.businessImpact}%</div>
                  <Progress value={vuln.businessImpact} className="h-1" />
                </div>
              </div>
            </div>

            <div className="flex gap-2 mt-3 pt-3 border-t border-border">
              <Button variant="outline" size="sm" className="flex-1 h-7 text-xs">
                View Details
              </Button>
              <Button size="sm" className="flex-1 h-7 text-xs">
                Start Remediation
              </Button>
            </div>
          </Card>
        ))}
      </div>
    </div>
  );
};

export default VulnerabilityPrioritizer;
